<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELOS Sentinel v3 - Full Browser OS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-tertiary: #1a2332;
            --bg-hover: #1f2937;
            --border: #2d3748;
            --border-muted: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --accent-primary: #00d9a3;
            --accent-secondary: #3b82f6;
            --accent-purple: #a78bfa;
            --accent-orange: #fb923c;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        h1, h2, h3, h4, h5 {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
        }

        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease, transform 0.3s ease;
            position: relative;
            z-index: 100;
        }

        .sidebar.collapsed {
            width: 60px;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-tertiary);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .sidebar-logo span {
            display: none;
        }

        .logo-icon {
            font-size: 24px;
        }

        .logo-text {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .toggle-sidebar {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.2s ease, color 0.2s ease;
        }

        .toggle-sidebar:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .nav-item {
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: background 0.2s ease, color 0.2s ease;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: rgba(0, 217, 163, 0.1);
            color: var(--accent-primary);
            border-left: 3px solid var(--accent-primary);
        }

        .nav-item-icon {
            font-size: 18px;
            min-width: 24px;
            text-align: center;
        }

        .sidebar.collapsed .nav-item-text {
            display: none;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            height: 60px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 40px 10px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 217, 163, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .filter-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }

        .filter-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        /* File Upload Zone */
        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 48px 24px;
            text-align: center;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 32px;
        }

        .upload-zone:hover,
        .upload-zone.drag-over {
            border-color: var(--accent-primary);
            background: rgba(0, 217, 163, 0.05);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }

        .upload-zone.drag-over .upload-icon {
            color: var(--accent-primary);
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .upload-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .upload-subtitle {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .upload-options {
            display: flex;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .visibility-toggle {
            display: flex;
            gap: 8px;
            background: var(--bg-tertiary);
            padding: 4px;
            border-radius: 8px;
        }

        .visibility-option {
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .visibility-option.active {
            background: var(--accent-primary);
            color: var(--bg-primary);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            background: #00c593;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 217, 163, 0.3);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
        }

        /* File Grid */
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .file-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .file-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .file-preview {
            width: 100%;
            height: 140px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .file-preview img,
        .file-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-icon {
            font-size: 48px;
            color: var(--text-muted);
        }

        .file-info {
            font-size: 14px;
        }

        .file-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-meta {
            font-size: 12px;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }

        .file-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-public {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent-secondary);
        }

        .badge-private {
            background: rgba(167, 139, 250, 0.2);
            color: var(--accent-purple);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
            flex: 1;
            overflow-y: auto;
        }

        .preview-container {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .preview-container img,
        .preview-container video {
            max-width: 100%;
            max-height: 500px;
            border-radius: 8px;
        }

        .preview-container iframe {
            width: 100%;
            height: 500px;
            border: none;
            border-radius: 8px;
        }

        .file-details {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-muted);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: var(--text-muted);
            font-size: 14px;
        }

        .detail-value {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Terminal */
        .terminal-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin-bottom: 20px;
        }

        .terminal-output {
            margin-bottom: 16px;
            max-height: 400px;
            overflow-y: auto;
            color: var(--text-secondary);
        }

        .terminal-line {
            margin-bottom: 8px;
        }

        .terminal-input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .terminal-prompt {
            color: var(--accent-primary);
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 13px;
            outline: none;
        }

        /* Code Editor */
        .editor-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .editor-header {
            background: var(--bg-tertiary);
            padding: 12px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-textarea {
            width: 100%;
            min-height: 400px;
            background: var(--bg-secondary);
            border: none;
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 20px;
            resize: vertical;
            outline: none;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-primary);
            font-family: 'Space Grotesk', sans-serif;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Media Dock */
        .media-dock {
            position: fixed;
            bottom: 0;
            left: 280px;
            right: 0;
            height: 300px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            z-index: 50;
            transition: transform 0.3s ease, left 0.3s ease;
            transform: translateY(100%);
        }

        .media-dock.active {
            transform: translateY(0);
        }

        .sidebar.collapsed ~ .main-content .media-dock {
            left: 60px;
        }

        .media-dock-header {
            padding: 12px 20px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .media-dock-content {
            height: calc(100% - 49px);
            overflow-y: auto;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        .media-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .media-card:hover {
            border-color: var(--accent-primary);
        }

        .media-preview {
            width: 100%;
            height: 180px;
            background: var(--bg-primary);
        }

        .media-preview iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .media-info {
            padding: 12px;
        }

        .media-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .media-meta {
            font-size: 12px;
            color: var(--text-muted);
        }

        .toggle-media-dock {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: var(--accent-primary);
            color: var(--bg-primary);
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 217, 163, 0.4);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .toggle-media-dock:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 217, 163, 0.6);
        }

        /* AI Chat Floating */
        .ai-chat-float {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 380px;
            height: 500px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 200;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            transform: translateY(600px);
        }

        .ai-chat-float.active {
            transform: translateY(0);
        }

        .ai-chat-header {
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .ai-chat-input-wrapper {
            padding: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }

        .toggle-ai-chat {
            position: fixed;
            bottom: 90px;
            right: 90px;
            width: 56px;
            height: 56px;
            background: var(--accent-secondary);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .toggle-ai-chat:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                left: 0;
                top: 0;
                height: 100%;
                transform: translateX(-100%);
                z-index: 200;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .files-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 16px;
            }

            .media-dock {
                left: 0;
            }

            .ai-chat-float {
                width: calc(100vw - 40px);
                right: 20px;
            }

            .media-dock-content {
                grid-template-columns: 1fr;
            }
        }

        /* Section Styles */
        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            color: var(--text-primary);
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 10px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 217, 163, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .success-box {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            font-size: 14px;
            color: var(--success);
        }

        /* Particles Animation */
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(0, 217, 163, 0.3);
            border-radius: 50%;
            animation: float linear infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--accent-primary);
            border-radius: 12px;
            padding: 16px 24px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 2000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <span class="logo-icon">üåê</span>
                    <span class="logo-text">ELOS Sentinel</span>
                </div>
                <button class="toggle-sidebar" onclick="toggleSidebar()">‚ò∞</button>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-item active" data-section="files">
                    <span class="nav-item-icon">üìÅ</span>
                    <span class="nav-item-text">File Manager</span>
                </div>
                <div class="nav-item" data-section="editor">
                    <span class="nav-item-icon">üíª</span>
                    <span class="nav-item-text">Code Editor</span>
                </div>
                <div class="nav-item" data-section="terminal">
                    <span class="nav-item-icon">‚ö°</span>
                    <span class="nav-item-text">Terminal</span>
                </div>
                <div class="nav-item" data-section="api">
                    <span class="nav-item-icon">üåê</span>
                    <span class="nav-item-text">API Gateway</span>
                </div>
                <div class="nav-item" data-section="identity">
                    <span class="nav-item-icon">üîê</span>
                    <span class="nav-item-text">Identity</span>
                </div>
                <div class="nav-item" data-section="blockchain">
                    <span class="nav-item-icon">‚õìÔ∏è</span>
                    <span class="nav-item-text">Blockchain</span>
                </div>
                <div class="nav-item" data-section="messages">
                    <span class="nav-item-icon">üí¨</span>
                    <span class="nav-item-text">Messages</span>
                </div>
                <div class="nav-item" data-section="social">
                    <span class="nav-item-icon">üåü</span>
                    <span class="nav-item-text">Social Feed</span>
                </div>
                <div class="nav-item" data-section="codelab">
                    <span class="nav-item-icon">üß™</span>
                    <span class="nav-item-text">Code Lab</span>
                </div>
                <div class="nav-item" data-section="explorer">
                    <span class="nav-item-icon">üîç</span>
                    <span class="nav-item-text">Explorer</span>
                </div>
                <div class="nav-item" data-section="elos">
                    <span class="nav-item-icon">‚ö°</span>
                    <span class="nav-item-text">ELOS-DEEP</span>
                </div>
                <div class="nav-item" data-section="pipeline">
                    <span class="nav-item-icon">üîÑ</span>
                    <span class="nav-item-text">Pipeline</span>
                </div>
                <div class="nav-item" data-section="ai">
                    <span class="nav-item-icon">ü§ñ</span>
                    <span class="nav-item-text">AI Assistant</span>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="search-bar">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search files...">
                    <span class="search-icon">üîç</span>
                </div>
                <div class="filter-controls">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="image">Images</button>
                    <button class="filter-btn" data-filter="video">Videos</button>
                    <button class="filter-btn" data-filter="document">Documents</button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- File Manager Section -->
                <div id="filesSection" class="content-section active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total Files</div>
                            <div class="stat-value" id="totalFiles">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Public (IPFS)</div>
                            <div class="stat-value" id="publicFiles">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Private (Local)</div>
                            <div class="stat-value" id="privateFiles">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total Size</div>
                            <div class="stat-value" id="totalSize">0 MB</div>
                        </div>
                    </div>

                    <div class="upload-zone" id="uploadZone">
                        <div class="upload-icon">üì§</div>
                        <div class="upload-title">Upload Files</div>
                        <div class="upload-subtitle">Drag & drop files here or click to browse</div>
                        <input type="file" id="fileInput" multiple hidden>
                        <div class="upload-options">
                            <div class="visibility-toggle">
                                <div class="visibility-option active" data-visibility="public">üåê Public (IPFS)</div>
                                <div class="visibility-option" data-visibility="private">üîí Private (Local)</div>
                            </div>
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                Choose Files
                            </button>
                        </div>
                    </div>

                    <div class="files-grid" id="filesGrid">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìÇ</div>
                            <p>No files uploaded yet</p>
                        </div>
                    </div>
                </div>

                <!-- Code Editor Section -->
                <div id="editorSection" class="content-section" style="display: none;">
                    <h2 class="section-title">Code Editor</h2>
                    <div class="editor-container">
                        <div class="editor-header">
                            <span id="editorFileName">untitled.js</span>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-primary" onclick="saveCode()">üíæ Save</button>
                                <button class="btn btn-sm btn-secondary" onclick="runCode()">‚ñ∂Ô∏è Run</button>
                            </div>
                        </div>
                        <textarea class="code-textarea" id="codeEditor" placeholder="// Write your code here...">// Welcome to ELOS Sentinel Code Editor
// Your code will be saved to IPFS

function hello(name) {
  return `Hello, ${name}!`;
}

console.log(hello('World'));</textarea>
                    </div>
                    <div class="terminal-container" style="margin-top: 20px;">
                        <div style="margin-bottom: 12px; color: var(--text-muted); font-size: 14px;">Output:</div>
                        <div class="terminal-output" id="codeOutput">Ready to run your code...</div>
                    </div>
                </div>

                <!-- Terminal Section -->
                <div id="terminalSection" class="content-section" style="display: none;">
                    <h2 class="section-title">Terminal</h2>
                    <div class="terminal-container">
                        <div class="terminal-output" id="terminalOutputArea">
                            ELOS Sentinel v3.0 - Full Browser OS
Type 'help' for available commands

                        </div>
                        <div class="terminal-input-wrapper">
                            <span class="terminal-prompt">$</span>
                            <input type="text" class="terminal-input" id="terminalInputField" placeholder="Enter command...">
                        </div>
                    </div>
                    <div class="info-box">
                        <strong>Available Commands:</strong> help, ls, clear, ipfs, storage, identity, blockchain, whoami
                    </div>
                </div>

                <!-- API Gateway Section -->
                <div id="apiSection" class="content-section" style="display: none;">
                    <h2 class="section-title">üöÄ CID API Gateway</h2>
                    <div class="info-box">
                        Turn any CID into a live API endpoint. Upload code to IPFS and call it as an API.
                    </div>
                    <div class="card">
                        <div class="card-title">üì° Your API Endpoints</div>
                        <div id="apiEndpointsList">
                            <p style="color: var(--text-muted);">No API endpoints yet. Upload code files marked as public.</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">Test API Endpoint</div>
                        <div class="form-group">
                            <label class="form-label">CID</label>
                            <input type="text" class="form-input" id="apiTestCID" placeholder="bafybei...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Input (JSON)</label>
                            <textarea class="form-textarea" id="apiTestInput" placeholder='{"x": 10, "y": 20}'></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="testAPI()">Test API Call</button>
                        <div class="terminal-container" style="margin-top: 20px;">
                            <div style="margin-bottom: 8px; color: var(--text-muted);">Response:</div>
                            <pre id="apiTestResponse" style="color: var(--text-secondary);">No response yet</pre>
                        </div>
                    </div>
                </div>

                <!-- Identity Section -->
                <div id="identitySection" class="content-section" style="display: none;">
                    <h2 class="section-title">üîê Identity Management</h2>
                    <div class="card">
                        <div class="card-title">Your Identity</div>
                        <div id="identityInfo">
                            <p style="color: var(--text-muted);">No identity generated yet</p>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generateIdentity()">üîë Generate Identity</button>
                        <button class="btn btn-secondary" onclick="exportIdentity()">üì§ Export</button>
                        <button class="btn btn-danger" onclick="clearIdentity()">üóëÔ∏è Clear</button>
                    </div>
                    <div class="card" style="margin-top: 20px;">
                        <div class="card-title">Sign Message</div>
                        <div class="form-group">
                            <label class="form-label">Message to Sign</label>
                            <input type="text" class="form-input" id="messageToSign" placeholder="Enter message...">
                        </div>
                        <button class="btn btn-primary" onclick="signMessage()">‚úçÔ∏è Sign Message</button>
                        <div id="signatureOutput" style="margin-top: 16px;"></div>
                    </div>
                </div>

                <!-- Blockchain Section -->
                <div id="blockchainSection" class="content-section" style="display: none;">
                    <h2 class="section-title">‚õìÔ∏è I-Am-Chain Blockchain</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Block Height</div>
                            <div class="stat-value" id="blockHeight">1</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Chain Length</div>
                            <div class="stat-value" id="chainLength">1</div>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="mineBlock()">‚õèÔ∏è Mine Block</button>
                        <button class="btn btn-secondary" onclick="viewChain()">üìä View Chain</button>
                    </div>
                    <div class="card" style="margin-top: 20px;">
                        <div class="card-title">Blockchain Data</div>
                        <div class="terminal-container">
                            <pre id="blockchainData" style="color: var(--text-secondary);">Initialize blockchain to see data</pre>
                        </div>
                    </div>
                </div>

                <!-- Messages Section -->
                <div id="messagesSection" class="content-section" style="display: none;">
                    <h2 class="section-title">üí¨ Encrypted Messages</h2>
                    <div class="card">
                        <div class="card-title">Send Message</div>
                        <div class="form-group">
                            <label class="form-label">Recipient Address</label>
                            <input type="text" class="form-input" id="msgRecipient" placeholder="0x...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Message</label>
                            <textarea class="form-textarea" id="msgContent" placeholder="Your encrypted message..."></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="sendMessage()">üì§ Send Encrypted</button>
                    </div>
                    <div class="card">
                        <div class="card-title">Message Inbox</div>
                        <div id="messagesInbox">
                            <p style="color: var(--text-muted);">No messages yet</p>
                        </div>
                    </div>
                </div>

                <!-- Social Section -->
                <div id="socialSection" class="content-section" style="display: none;">
                    <h2 class="section-title">üåü Social Feed</h2>
                    <div class="card">
                        <div class="card-title">Create Post</div>
                        <div class="form-group">
                            <textarea class="form-textarea" id="postContent" placeholder="What's on your mind?"></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="publishPost()">üì¢ Publish to IPFS</button>
                    </div>
                    <div class="card">
                        <div class="card-title">Feed</div>
                        <div id="socialFeed">
                            <p style="color: var(--text-muted);">No posts yet</p>
                        </div>
                    </div>
                </div>

                <!-- Code Lab Section -->
                <div id="codelabSection" class="content-section" style="display: none;">
                    <h2 class="section-title">üß™ Code Lab (DSL)</h2>
                    <div class="info-box">
                        Execute Fractal DSL code in the browser. Experimental runtime environment.
                    </div>
                    <div class="editor-container">
                        <div class="editor-header">
                            <span>Fractal DSL Editor</span>
                            <button class="btn btn-sm btn-primary" onclick="executeDSL()">‚ñ∂Ô∏è Execute</button>
                        </div>
                        <textarea class="code-textarea" id="dslEditor" placeholder="Enter DSL code...">pulse identity {
  mod karma +10
  emit zkproof
}

capsule agent {
  spawn "my-agent"
  task "compute"
}</textarea>
                    </div>
                    <div class="terminal-container" style="margin-top: 20px;">
                        <div style="margin-bottom: 8px; color: var(--text-muted);">DSL Output:</div>
                        <pre id="dslOutput" style="color: var(--text-secondary);">Ready to execute DSL code...</pre>
                    </div>
                </div>

                <!-- Explorer Section -->
                <div id="explorerSection" class="content-section" style="display: none;">
                    <h2 class="section-title">üîç ELOS Explorer</h2>
                    <div class="card">
                        <div class="card-title">System Status</div>
                        <div class="detail-row">
                            <span class="detail-label">IPFS Node</span>
                            <span class="detail-value" id="ipfsStatus">‚è≥ Initializing...</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">IndexedDB</span>
                            <span class="detail-value" id="indexedDBStatus">‚úÖ Ready</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Identity</span>
                            <span class="detail-value" id="identityStatus">‚ùå Not Generated</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">Storage Info</div>
                        <div class="detail-row">
                            <span class="detail-label">Browser Storage Used</span>
                            <span class="detail-value" id="storageUsed">0 MB</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">IPFS Pinned Content</span>
                            <span class="detail-value" id="ipfsPinned">0</span>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="refreshExplorer()">üîÑ Refresh</button>
                        <button class="btn btn-secondary" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
                    </div>
                </div>

                <!-- ELOS-DEEP Section -->
                <div id="elosSection" class="content-section" style="display: none;">
                    <h2 class="section-title">‚ö° ELOS-DEEP Engine</h2>
                    <div class="info-box">
                        Browser-compatible recursive compute engine. Search for Ethereum addresses with specific patterns using massive parallelism.
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Core Configuration</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label class="form-label">Depth (Recursion Levels)</label>
                                <input type="number" class="form-input" id="elosDepth" value="8" min="1" max="15">
                                <small style="color: var(--text-muted); font-size: 12px;">1-15 levels</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Branch Factor</label>
                                <input type="number" class="form-input" id="elosBranch" value="3" min="2" max="20">
                                <small style="color: var(--text-muted); font-size: 12px;">2-20 branches</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pulse Interval (ms)</label>
                                <input type="number" class="form-input" id="elosPulseMs" value="250" min="10" max="10000">
                                <small style="color: var(--text-muted); font-size: 12px;">10-10000ms</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Max Tasks Per Pulse</label>
                                <input type="number" class="form-input" id="elosMaxTasks" value="200000" min="1000" max="10000000">
                                <small style="color: var(--text-muted); font-size: 12px;">1K-10M tasks</small>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">Search Parameters</div>
                        <div class="form-group">
                            <label class="form-label">Target Pattern</label>
                            <input type="text" class="form-input" id="elosTarget" value="000000" placeholder="e.g., 000000 or abc123">
                            <small style="color: var(--text-muted); font-size: 12px;">Search for this pattern in addresses</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Search Mode</label>
                            <select class="form-select" id="elosSearchMode">
                                <option value="contains">Contains (anywhere)</option>
                                <option value="startsWith">Starts With</option>
                                <option value="endsWith">Ends With</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Case Sensitive</label>
                            <select class="form-select" id="elosCaseSensitive">
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </select>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">Performance Tuning</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label class="form-label">Worker Threads (simulation)</label>
                                <input type="number" class="form-input" id="elosWorkers" value="4" min="1" max="16">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Auto-stop on Match</label>
                                <select class="form-select" id="elosAutoStop">
                                    <option value="true">Yes</option>
                                    <option value="false">No (find multiple)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Log Frequency (pulses)</label>
                                <input type="number" class="form-input" id="elosLogFreq" value="10" min="1" max="100">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Batch Size</label>
                                <input type="number" class="form-input" id="elosBatchSize" value="1000" min="100" max="100000">
                            </div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" id="startElos">‚ö° Start Engine</button>
                        <button class="btn btn-danger" id="stopElos">‚èπÔ∏è Stop Engine</button>
                    </div>

                    <div class="stats-grid" style="margin-top: 20px;">
                        <div class="stat-card">
                            <div class="stat-label">Pulses</div>
                            <div class="stat-value" id="statPulses">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Addresses Checked</div>
                            <div class="stat-value" id="statChecked">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Rate (ops/s)</div>
                            <div class="stat-value" id="statRate">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Pulse Time (ms)</div>
                            <div class="stat-value" id="statPulseTime">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Tasks/Pulse</div>
                            <div class="stat-value" id="statTasks">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Memory (MB)</div>
                            <div class="stat-value" id="statMemory">0</div>
                        </div>
                    </div>

                    <div class="terminal-container" style="margin-top: 20px;">
                        <div style="margin-bottom: 8px; color: var(--text-muted);">Engine Log:</div>
                        <pre id="elosLog" style="color: var(--text-secondary); max-height: 300px; overflow-y: auto;">Ready to start ELOS-DEEP engine...</pre>
                    </div>

                    <div id="elosResults" class="success-box" style="display: none; margin-top: 20px;">
                        <pre id="elosMatch" style="font-family: 'Courier New', monospace; font-size: 13px; white-space: pre-wrap;"></pre>
                    </div>
                </div>

                <!-- Pipeline Section -->
                <div id="pipelineSection" class="content-section" style="display: none;">
                    <h2 class="section-title">üîÑ Data Pipeline</h2>
                    <div class="info-box">
                        Create and execute data processing pipelines. Write functions that transform data through multiple stages.
                    </div>

                    <div class="editor-container">
                        <div class="editor-header">
                            <span>Pipeline Code</span>
                            <button class="btn btn-sm btn-primary" id="runPipeline">‚ñ∂Ô∏è Run Pipeline</button>
                        </div>
                        <textarea class="code-textarea" id="pipelineCode" style="min-height: 300px;">// Define your data pipeline
async function pipeline(input) {
  // Stage 1: Extract
  const data = input.numbers;
  
  // Stage 2: Transform
  const doubled = data.map(x => x * 2);
  const sum = doubled.reduce((a, b) => a + b, 0);
  
  // Stage 3: Aggregate
  return {
    original: data,
    doubled: doubled,
    sum: sum,
    average: sum / doubled.length,
    timestamp: new Date().toISOString()
  };
}</textarea>
                    </div>

                    <div class="terminal-container" style="margin-top: 20px;">
                        <div style="margin-bottom: 8px; color: var(--text-muted);">Pipeline Output:</div>
                        <pre id="pipelineOutput" style="color: var(--text-secondary);">Run the pipeline to see results...</pre>
                    </div>
                </div>

                <!-- AI Assistant Section -->
                <div id="aiSection" class="content-section" style="display: none;">
                    <h2 class="section-title">ü§ñ AI Assistant</h2>
                    <div class="info-box">
                        AI-powered assistant to help optimize ELOS-DEEP performance and workflow design.
                    </div>

                    <div class="card">
                        <div style="height: 400px; overflow-y: auto; margin-bottom: 16px; padding: 16px; background: var(--bg-tertiary); border-radius: 8px;" id="chatMessages">
                            <div style="color: var(--text-muted); text-align: center; padding: 40px 20px;">
                                <div style="font-size: 48px; margin-bottom: 16px;">ü§ñ</div>
                                <p>AI Assistant Ready</p>
                                <p style="font-size: 13px; margin-top: 8px;">Ask me about ELOS optimization, pipeline design, or system analysis</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <input type="text" class="form-input" id="chatInput" placeholder="Ask me anything..." style="flex: 1;">
                            <button class="btn btn-primary" id="sendChat">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Particles Background -->
    <div id="particles" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden;"></div>

    <!-- Media Dock -->
    <div class="media-dock" id="mediaDock">
        <div class="media-dock-header">
            <div style="display: flex; align-items: center; gap: 16px;">
                <span style="font-size: 16px; font-weight: 600; color: var(--text-primary);">üì∫ Media Dock</span>
                <button class="btn btn-sm btn-primary" onclick="addMediaSource()">+ Add Media</button>
            </div>
            <button class="btn btn-sm btn-secondary" onclick="toggleMediaDock()">‚àí</button>
        </div>
        <div class="media-dock-content" id="mediaContent">
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-muted);">
                <div style="font-size: 48px; margin-bottom: 16px;">üì∫</div>
                <p>No media sources added yet</p>
                <p style="font-size: 13px; margin-top: 8px;">Click "+ Add Media" to import YouTube, Facebook, or other media</p>
            </div>
        </div>
    </div>

    <!-- Floating AI Chat -->
    <div class="ai-chat-float" id="aiChatFloat">
        <div class="ai-chat-header">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 24px;">ü§ñ</span>
                <div>
                    <div style="font-weight: 600; font-size: 14px; color: var(--text-primary);">AI Assistant</div>
                    <div style="font-size: 11px; color: var(--text-muted);">Always here to help</div>
                </div>
            </div>
            <button class="btn btn-sm btn-secondary" onclick="toggleAIChat()">‚àí</button>
        </div>
        <div class="ai-chat-messages" id="aiChatMessagesFloat">
            <div style="color: var(--text-muted); text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">ü§ñ</div>
                <p>AI Assistant Ready</p>
                <p style="font-size: 13px; margin-top: 8px;">Ask me about ELOS optimization, pipeline design, or system analysis</p>
            </div>
        </div>
        <div class="ai-chat-input-wrapper">
            <input type="text" class="form-input" id="aiChatInputFloat" placeholder="Ask me anything..." style="flex: 1; margin-bottom: 0;">
            <button class="btn btn-primary" onclick="sendAIMessage()">Send</button>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <button class="toggle-ai-chat" onclick="toggleAIChat()" title="AI Assistant">ü§ñ</button>
    <button class="toggle-media-dock" onclick="toggleMediaDock()" title="Media Dock">üì∫</button>

    <!-- Preview Modal -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalFileName">File Preview</div>
                <button class="modal-close" onclick="closePreview()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="preview-container" id="previewContainer">
                    <!-- Preview content will be inserted here -->
                </div>
                <div class="file-details">
                    <div class="detail-row">
                        <span class="detail-label">File Name</span>
                        <span class="detail-value" id="detailName">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Type</span>
                        <span class="detail-value" id="detailType">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Size</span>
                        <span class="detail-value" id="detailSize">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Visibility</span>
                        <span class="detail-value" id="detailVisibility">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">CID / Path</span>
                        <span class="detail-value" id="detailCID" style="word-break: break-all;">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Upload Date</span>
                        <span class="detail-value" id="detailDate">-</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="downloadFile()">‚¨áÔ∏è Download</button>
                <button class="btn btn-secondary" onclick="shareFile()">üîó Share</button>
                <button class="btn btn-danger" onclick="deleteFile()">üóëÔ∏è Delete</button>
            </div>
        </div>
    </div>

    <!-- Helia IPFS SDK -->
    <script type="module">
        // Import Helia and dependencies
        import { createHelia } from 'https://esm.sh/helia@4.0.2';
        import { unixfs } from 'https://esm.sh/@helia/unixfs@3.0.6';
        import { CID } from 'https://esm.sh/multiformats@13.1.0/cid';
        import { createLibp2p } from 'https://esm.sh/libp2p@1.2.1';
        import { identify } from 'https://esm.sh/@libp2p/identify@1.0.14';
        import { noise } from 'https://esm.sh/@chainsafe/libp2p-noise@15.0.0';
        import { yamux } from 'https://esm.sh/@chainsafe/libp2p-yamux@6.0.2';
        import { webSockets } from 'https://esm.sh/@libp2p/websockets@8.0.18';
        import { webRTC } from 'https://esm.sh/@libp2p/webrtc@4.0.24';
        import { circuitRelayTransport } from 'https://esm.sh/@libp2p/circuit-relay-v2@1.0.18';

        // Global state
        window.appState = {
            helia: null,
            fs: null,
            files: [],
            currentFile: null,
            visibility: 'public',
            identity: null,
            blockchain: [],
            filterType: 'all',
            searchQuery: '',
            posts: []
        };

        // Initialize Helia IPFS Node with proper libp2p configuration
        async function initHelia() {
            try {
                console.log('Initializing Helia IPFS node...');
                
                const libp2pConfig = {
                    addresses: {
                        listen: []
                    },
                    transports: [
                        webSockets(),
                        webRTC(),
                        circuitRelayTransport()
                    ],
                    connectionEncryption: [
                        noise()
                    ],
                    streamMuxers: [
                        yamux()
                    ],
                    services: {
                        identify: identify()
                    }
                };

                window.appState.helia = await createHelia({
                    libp2p: libp2pConfig
                });
                window.appState.fs = unixfs(window.appState.helia);
                console.log('‚úÖ Helia IPFS node initialized');
                document.getElementById('ipfsStatus').textContent = '‚úÖ Connected';
                addTerminalLine('‚úÖ IPFS node initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Helia:', error);
                document.getElementById('ipfsStatus').textContent = '‚ö†Ô∏è Fallback Mode';
                addTerminalLine('‚ö†Ô∏è IPFS running in fallback mode (mock storage)');
                // Use mock storage as fallback
                window.appState.helia = { mock: true };
                window.appState.fs = { mock: true };
            }
        }

        // Initialize IndexedDB
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('ELOSFilesDB', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('files')) {
                        const store = db.createObjectStore('files', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('name', 'name', { unique: false });
                        store.createIndex('type', 'type', { unique: false });
                        store.createIndex('date', 'date', { unique: false });
                    }
                };
            });
        }

        // Save file to IndexedDB
        async function saveToIndexedDB(fileData) {
            const db = await initIndexedDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['files'], 'readwrite');
                const store = transaction.objectStore('files');
                const request = store.add(fileData);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // Get all files from IndexedDB
        async function getAllFilesFromIndexedDB() {
            const db = await initIndexedDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['files'], 'readonly');
                const store = transaction.objectStore('files');
                const request = store.getAll();
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // Delete file from IndexedDB
        async function deleteFromIndexedDB(id) {
            const db = await initIndexedDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['files'], 'readwrite');
                const store = transaction.objectStore('files');
                const request = store.delete(id);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        // Upload file to IPFS (Helia)
        async function uploadToIPFS(file) {
            if (!window.appState.fs) {
                throw new Error('IPFS node not initialized');
            }

            // Check if in fallback mode
            if (window.appState.fs.mock) {
                // Mock IPFS upload - generate fake CID
                const mockCID = 'bafybei' + Array.from({length: 52}, () => 
                    'abcdefghijklmnopqrstuvwxyz234567'[Math.floor(Math.random() * 32)]
                ).join('');
                console.log('Mock IPFS upload - CID:', mockCID);
                return mockCID;
            }

            try {
                const arrayBuffer = await file.arrayBuffer();
                const uint8Array = new Uint8Array(arrayBuffer);
                
                // Add file to IPFS
                const cid = await window.appState.fs.addBytes(uint8Array);
                console.log('File uploaded to IPFS with CID:', cid.toString());
                
                return cid.toString();
            } catch (error) {
                console.error('IPFS upload failed:', error);
                throw error;
            }
        }

        // Handle file upload
        window.handleFileUpload = async function(files) {
            const visibility = window.appState.visibility;
            
            for (const file of files) {
                try {
                    addTerminalLine(`Uploading ${file.name} (${visibility})...`);
                    
                    let cidOrPath = '';
                    let fileData = null;
                    
                    if (visibility === 'public') {
                        // Upload to IPFS
                        cidOrPath = await uploadToIPFS(file);
                        fileData = {
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            visibility: 'public',
                            cid: cidOrPath,
                            date: new Date().toISOString(),
                            preview: await generatePreviewURL(file)
                        };
                        addTerminalLine(`‚úÖ Uploaded to IPFS: ${cidOrPath}`);
                    } else {
                        // Save to IndexedDB
                        const arrayBuffer = await file.arrayBuffer();
                        fileData = {
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            visibility: 'private',
                            data: arrayBuffer,
                            date: new Date().toISOString(),
                            preview: await generatePreviewURL(file)
                        };
                        const id = await saveToIndexedDB(fileData);
                        fileData.id = id;
                        addTerminalLine(`‚úÖ Saved to local storage (ID: ${id})`);
                    }
                    
                    window.appState.files.push(fileData);
                } catch (error) {
                    console.error('Upload failed:', error);
                    addTerminalLine(`‚ùå Upload failed for ${file.name}: ${error.message}`);
                }
            }
            
            await refreshFilesList();
            updateStats();
        };

        // Generate preview URL
        async function generatePreviewURL(file) {
            return new Promise((resolve) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(file);
                } else if (file.type.startsWith('video/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(file);
                } else {
                    resolve(null);
                }
            });
        }

        // Refresh files list
        async function refreshFilesList() {
            // Load files from IndexedDB
            const privateFiles = await getAllFilesFromIndexedDB();
            
            // Merge with public files (already in appState)
            const allFiles = [
                ...window.appState.files.filter(f => f.visibility === 'public'),
                ...privateFiles.map(f => ({ ...f, visibility: 'private' }))
            ];
            
            window.appState.files = allFiles;
            renderFiles();
        }

        // Render files grid
        function renderFiles() {
            const grid = document.getElementById('filesGrid');
            const filtered = window.appState.files.filter(file => {
                const matchesType = window.appState.filterType === 'all' || 
                                   (window.appState.filterType === 'image' && file.type.startsWith('image/')) ||
                                   (window.appState.filterType === 'video' && file.type.startsWith('video/')) ||
                                   (window.appState.filterType === 'document' && !file.type.startsWith('image/') && !file.type.startsWith('video/'));
                
                const matchesSearch = !window.appState.searchQuery || 
                                     file.name.toLowerCase().includes(window.appState.searchQuery.toLowerCase());
                
                return matchesType && matchesSearch;
            });

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÇ</div>
                        <p>No files found</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map((file, index) => {
                const fileIcon = getFileIcon(file.type);
                const preview = file.preview ? 
                    (file.type.startsWith('image/') ? `<img src="${file.preview}" alt="${file.name}">` :
                     file.type.startsWith('video/') ? `<video src="${file.preview}"></video>` :
                     `<div class="file-icon">${fileIcon}</div>`) :
                    `<div class="file-icon">${fileIcon}</div>`;

                return `
                    <div class="file-card" onclick="previewFile(${index})">
                        <div class="file-badge ${file.visibility === 'public' ? 'badge-public' : 'badge-private'}">
                            ${file.visibility === 'public' ? 'PUBLIC' : 'PRIVATE'}
                        </div>
                        <div class="file-preview">
                            ${preview}
                        </div>
                        <div class="file-info">
                            <div class="file-name" title="${file.name}">${file.name}</div>
                            <div class="file-meta">
                                <span>${formatFileSize(file.size)}</span>
                                <span>${new Date(file.date).toLocaleDateString()}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Get file icon
        function getFileIcon(type) {
            if (type.startsWith('image/')) return 'üñºÔ∏è';
            if (type.startsWith('video/')) return 'üé¨';
            if (type.startsWith('audio/')) return 'üéµ';
            if (type.includes('pdf')) return 'üìÑ';
            if (type.includes('document') || type.includes('word')) return 'üìù';
            if (type.includes('sheet') || type.includes('excel')) return 'üìä';
            if (type.includes('presentation') || type.includes('powerpoint')) return 'üìΩÔ∏è';
            if (type.includes('zip') || type.includes('rar')) return 'üì¶';
            return 'üìÑ';
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Preview file
        window.previewFile = function(index) {
            const file = window.appState.files.filter(f => {
                const matchesType = window.appState.filterType === 'all' || 
                                   (window.appState.filterType === 'image' && f.type.startsWith('image/')) ||
                                   (window.appState.filterType === 'video' && f.type.startsWith('video/')) ||
                                   (window.appState.filterType === 'document' && !f.type.startsWith('image/') && !f.type.startsWith('video/'));
                
                const matchesSearch = !window.appState.searchQuery || 
                                     f.name.toLowerCase().includes(window.appState.searchQuery.toLowerCase());
                
                return matchesType && matchesSearch;
            })[index];

            window.appState.currentFile = file;

            document.getElementById('modalFileName').textContent = file.name;
            document.getElementById('detailName').textContent = file.name;
            document.getElementById('detailType').textContent = file.type;
            document.getElementById('detailSize').textContent = formatFileSize(file.size);
            document.getElementById('detailVisibility').textContent = file.visibility.toUpperCase();
            document.getElementById('detailCID').textContent = file.cid || `Local ID: ${file.id}`;
            document.getElementById('detailDate').textContent = new Date(file.date).toLocaleString();

            const previewContainer = document.getElementById('previewContainer');
            
            if (file.type.startsWith('image/')) {
                previewContainer.innerHTML = `<img src="${file.preview}" alt="${file.name}">`;
            } else if (file.type.startsWith('video/')) {
                previewContainer.innerHTML = `<video src="${file.preview}" controls></video>`;
            } else if (file.type === 'application/pdf') {
                previewContainer.innerHTML = `<iframe src="${file.preview}"></iframe>`;
            } else if (file.type.startsWith('text/')) {
                previewContainer.innerHTML = `<pre style="text-align: left; max-height: 500px; overflow-y: auto; color: var(--text-secondary);">${file.data || 'Preview not available'}</pre>`;
            } else {
                previewContainer.innerHTML = `<div class="file-icon" style="font-size: 120px;">${getFileIcon(file.type)}</div>`;
            }

            document.getElementById('previewModal').classList.add('active');
        };

        // Close preview
        window.closePreview = function() {
            document.getElementById('previewModal').classList.remove('active');
            window.appState.currentFile = null;
        };

        // Download file
        window.downloadFile = function() {
            const file = window.appState.currentFile;
            if (!file) return;

            const a = document.createElement('a');
            a.href = file.preview || '#';
            a.download = file.name;
            a.click();
        };

        // Share file
        window.shareFile = function() {
            const file = window.appState.currentFile;
            if (!file) return;

            if (file.visibility === 'public' && file.cid) {
                const url = `https://ipfs.io/ipfs/${file.cid}`;
                navigator.clipboard.writeText(url);
                addTerminalLine(`‚úÖ IPFS URL copied: ${url}`);
                alert('IPFS URL copied to clipboard!');
            } else {
                alert('Only public files can be shared via IPFS');
            }
        };

        // Delete file
        window.deleteFile = async function() {
            const file = window.appState.currentFile;
            if (!file) return;

            if (!confirm(`Delete ${file.name}?`)) return;

            try {
                if (file.visibility === 'private' && file.id) {
                    await deleteFromIndexedDB(file.id);
                }
                
                window.appState.files = window.appState.files.filter(f => f !== file);
                await refreshFilesList();
                updateStats();
                closePreview();
                addTerminalLine(`‚úÖ Deleted: ${file.name}`);
            } catch (error) {
                console.error('Delete failed:', error);
                addTerminalLine(`‚ùå Delete failed: ${error.message}`);
            }
        };

        // Update stats
        function updateStats() {
            const total = window.appState.files.length;
            const publicCount = window.appState.files.filter(f => f.visibility === 'public').length;
            const privateCount = window.appState.files.filter(f => f.visibility === 'private').length;
            const totalSize = window.appState.files.reduce((sum, f) => sum + f.size, 0);

            document.getElementById('totalFiles').textContent = total;
            document.getElementById('publicFiles').textContent = publicCount;
            document.getElementById('privateFiles').textContent = privateCount;
            document.getElementById('totalSize').textContent = (totalSize / (1024 * 1024)).toFixed(2);
        }

        // Terminal functions
        function addTerminalLine(text) {
            const output = document.getElementById('terminalOutputArea');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        // Event listeners
        document.getElementById('fileInput').addEventListener('change', (e) => {
            handleFileUpload(Array.from(e.target.files));
        });

        const uploadZone = document.getElementById('uploadZone');
        uploadZone.addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('drag-over');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('drag-over');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('drag-over');
            handleFileUpload(Array.from(e.dataTransfer.files));
        });

        // Visibility toggle
        document.querySelectorAll('.visibility-option').forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                document.querySelectorAll('.visibility-option').forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                window.appState.visibility = option.dataset.visibility;
            });
        });

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                window.appState.filterType = btn.dataset.filter;
                renderFiles();
            });
        });

        // Search
        document.getElementById('searchInput').addEventListener('input', (e) => {
            window.appState.searchQuery = e.target.value;
            renderFiles();
        });

        // Terminal input
        document.getElementById('terminalInputField').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const cmd = e.target.value.trim();
                addTerminalLine(`$ ${cmd}`);
                executeTerminalCommand(cmd);
                e.target.value = '';
            }
        });

        function executeTerminalCommand(cmd) {
            const parts = cmd.split(' ');
            const command = parts[0];

            switch(command) {
                case 'help':
                    addTerminalLine('Available commands:');
                    addTerminalLine('  ls - List files');
                    addTerminalLine('  clear - Clear terminal');
                    addTerminalLine('  ipfs - IPFS status');
                    addTerminalLine('  storage - Storage info');
                    addTerminalLine('  identity - Identity status');
                    break;
                case 'ls':
                    addTerminalLine(`Total files: ${window.appState.files.length}`);
                    window.appState.files.forEach(f => {
                        addTerminalLine(`  ${f.name} (${f.visibility})`);
                    });
                    break;
                case 'clear':
                    document.getElementById('terminalOutputArea').innerHTML = '';
                    break;
                case 'ipfs':
                    addTerminalLine(`IPFS Status: ${window.appState.helia ? '‚úÖ Connected' : '‚ùå Disconnected'}`);
                    break;
                case 'storage':
                    const totalSize = window.appState.files.reduce((sum, f) => sum + f.size, 0);
                    addTerminalLine(`Total storage used: ${formatFileSize(totalSize)}`);
                    break;
                case 'identity':
                    addTerminalLine(`Identity: ${window.appState.identity ? '‚úÖ Generated' : '‚ùå Not generated'}`);
                    break;
                default:
                    addTerminalLine(`Unknown command: ${command}`);
            }
        }

        // Initialize app
        async function init() {
            console.log('Initializing ELOS Sentinel v3...');
            await initHelia();
            await initIndexedDB();
            await refreshFilesList();
            updateStats();
            addTerminalLine('‚úÖ ELOS Sentinel v3 initialized');
            addTerminalLine('üåê Ready for file uploads');
        }

        // Start initialization
        init();

        // Export functions to window
        window.addTerminalLine = addTerminalLine;
        window.formatFileSize = formatFileSize;
    </script>

    <script>
        // Navigation
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        // Section navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const section = item.dataset.section;
                
                // Update nav
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                // Show section
                document.querySelectorAll('.content-section').forEach(s => s.style.display = 'none');
                document.getElementById(section + 'Section').style.display = 'block';
            });
        });

        // Code Editor
        function saveCode() {
            const code = document.getElementById('codeEditor').value;
            const blob = new Blob([code], { type: 'text/javascript' });
            const file = new File([blob], document.getElementById('editorFileName').textContent, { type: 'text/javascript' });
            window.handleFileUpload([file]);
            window.addTerminalLine('‚úÖ Code saved');
        }

        function runCode() {
            const code = document.getElementById('codeEditor').value;
            const output = document.getElementById('codeOutput');
            
            try {
                // Capture console.log
                const logs = [];
                const oldLog = console.log;
                console.log = (...args) => {
                    logs.push(args.join(' '));
                    oldLog.apply(console, args);
                };
                
                // Execute code
                eval(code);
                
                // Restore console.log
                console.log = oldLog;
                
                output.textContent = logs.join('\n') || 'Code executed successfully (no output)';
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }

        // Identity Management
        function generateIdentity() {
            // Simple identity generation (in production, use proper crypto)
            const identity = {
                address: '0x' + Array.from({length: 40}, () => Math.floor(Math.random() * 16).toString(16)).join(''),
                publicKey: Array.from({length: 64}, () => Math.floor(Math.random() * 16).toString(16)).join(''),
                createdAt: new Date().toISOString()
            };
            
            window.appState.identity = identity;
            localStorage.setItem('elos_identity', JSON.stringify(identity));
            
            document.getElementById('identityInfo').innerHTML = `
                <div style="font-size: 13px; word-break: break-all;">
                    <p style="margin-bottom: 12px;"><strong>Address:</strong><br>${identity.address}</p>
                    <p style="margin-bottom: 12px;"><strong>Public Key:</strong><br>${identity.publicKey}</p>
                    <p><strong>Created:</strong> ${new Date(identity.createdAt).toLocaleString()}</p>
                </div>
            `;
            
            document.getElementById('identityStatus').textContent = '‚úÖ Generated';
            window.addTerminalLine('‚úÖ Identity generated');
        }

        function exportIdentity() {
            if (!window.appState.identity) {
                alert('No identity to export');
                return;
            }
            
            const blob = new Blob([JSON.stringify(window.appState.identity, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'elos-identity.json';
            a.click();
            window.addTerminalLine('‚úÖ Identity exported');
        }

        function clearIdentity() {
            if (!confirm('Clear identity? This cannot be undone.')) return;
            
            window.appState.identity = null;
            localStorage.removeItem('elos_identity');
            document.getElementById('identityInfo').innerHTML = '<p style="color: var(--text-muted);">No identity generated yet</p>';
            document.getElementById('identityStatus').textContent = '‚ùå Not Generated';
            window.addTerminalLine('Identity cleared');
        }

        function signMessage() {
            if (!window.appState.identity) {
                alert('Generate identity first');
                return;
            }
            
            const message = document.getElementById('messageToSign').value;
            if (!message) {
                alert('Enter a message to sign');
                return;
            }
            
            // Simple signature (in production, use proper cryptographic signing)
            const signature = btoa(message + window.appState.identity.publicKey);
            
            document.getElementById('signatureOutput').innerHTML = `
                <div class="success-box">
                    <strong>Signature:</strong><br>
                    <code style="word-break: break-all; font-size: 12px;">${signature}</code>
                </div>
            `;
            
            window.addTerminalLine('‚úÖ Message signed');
        }

        // Blockchain
        function mineBlock() {
            if (!window.appState.blockchain.length) {
                // Genesis block
                window.appState.blockchain = [{
                    index: 0,
                    timestamp: Date.now(),
                    data: 'Genesis Block',
                    hash: '0'.repeat(64)
                }];
            }
            
            const prevBlock = window.appState.blockchain[window.appState.blockchain.length - 1];
            const newBlock = {
                index: prevBlock.index + 1,
                timestamp: Date.now(),
                data: `Block ${prevBlock.index + 1}`,
                previousHash: prevBlock.hash,
                hash: Array.from({length: 64}, () => Math.floor(Math.random() * 16).toString(16)).join('')
            };
            
            window.appState.blockchain.push(newBlock);
            document.getElementById('blockHeight').textContent = newBlock.index;
            document.getElementById('chainLength').textContent = window.appState.blockchain.length;
            window.addTerminalLine(`‚úÖ Block ${newBlock.index} mined`);
        }

        function viewChain() {
            document.getElementById('blockchainData').textContent = JSON.stringify(window.appState.blockchain, null, 2);
        }

        // Messages
        function sendMessage() {
            const recipient = document.getElementById('msgRecipient').value;
            const content = document.getElementById('msgContent').value;
            
            if (!recipient || !content) {
                alert('Fill in all fields');
                return;
            }
            
            window.addTerminalLine(`‚úÖ Message sent to ${recipient}`);
            document.getElementById('msgRecipient').value = '';
            document.getElementById('msgContent').value = '';
        }

        // Social
        function publishPost() {
            const content = document.getElementById('postContent').value;
            
            if (!content) {
                alert('Write something to publish');
                return;
            }
            
            window.addTerminalLine('‚úÖ Post published to IPFS');
            document.getElementById('postContent').value = '';
        }

        // Code Lab
        function executeDSL() {
            const code = document.getElementById('dslEditor').value;
            document.getElementById('dslOutput').textContent = `Executing DSL...\n\n${code}\n\n‚úÖ DSL executed (simulated)`;
            window.addTerminalLine('‚úÖ DSL code executed');
        }

        // API Gateway
        function testAPI() {
            const cid = document.getElementById('apiTestCID').value;
            const input = document.getElementById('apiTestInput').value;
            
            if (!cid) {
                alert('Enter a CID');
                return;
            }
            
            document.getElementById('apiTestResponse').textContent = `Testing API endpoint: ${cid}\n\nInput: ${input}\n\n‚úÖ API call simulated`;
            window.addTerminalLine(`‚úÖ API tested: ${cid}`);
        }

        // Explorer
        function refreshExplorer() {
            document.getElementById('storageUsed').textContent = 
                (window.appState.files.reduce((sum, f) => sum + f.size, 0) / (1024 * 1024)).toFixed(2) + ' MB';
            document.getElementById('ipfsPinned').textContent = 
                window.appState.files.filter(f => f.visibility === 'public').length;
            window.addTerminalLine('‚úÖ Explorer refreshed');
        }

        function clearAllData() {
            if (!confirm('Clear all data? This cannot be undone.')) return;
            
            window.appState.files = [];
            localStorage.clear();
            indexedDB.deleteDatabase('ELOSFilesDB');
            location.reload();
        }

        // Load saved identity on startup
        window.addEventListener('load', () => {
            const savedIdentity = localStorage.getItem('elos_identity');
            if (savedIdentity) {
                window.appState.identity = JSON.parse(savedIdentity);
                document.getElementById('identityInfo').innerHTML = `
                    <div style="font-size: 13px; word-break: break-all;">
                        <p style="margin-bottom: 12px;"><strong>Address:</strong><br>${window.appState.identity.address}</p>
                        <p style="margin-bottom: 12px;"><strong>Public Key:</strong><br>${window.appState.identity.publicKey}</p>
                        <p><strong>Created:</strong> ${new Date(window.appState.identity.createdAt).toLocaleString()}</p>
                    </div>
                `;
                document.getElementById('identityStatus').textContent = '‚úÖ Generated';
            }
        });

        // ============================================================================
        // ELOS-DEEP ENGINE (Browser-Compatible)
        // ============================================================================
        class ELOSEngine {
            constructor() {
                this.depth = 8;
                this.branch = 3;
                this.pulseMs = 250;
                this.maxTasksPerPulse = 200000;
                this.target = "000000";
                this.searchMode = "contains";
                this.caseSensitive = false;
                this.autoStop = true;
                this.logFreq = 10;
                this.batchSize = 1000;
                this.workers = 4;
                this.totalChecked = 0;
                this.pulses = 0;
                this.found = [];
                this.running = false;
                this.interval = null;
                this.rateWindow = [];
                this.lastTotal = 0;
            }

            // Generate random Ethereum address (browser-compatible)
            randomEthAddress() {
                const bytes = new Uint8Array(20);
                crypto.getRandomValues(bytes);
                return "0x" + Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
            }

            // Nano operation: single address check with configurable matching
            nanoOp() {
                const addr = this.randomEthAddress();
                this.totalChecked++;
                
                const checkAddr = this.caseSensitive ? addr : addr.toLowerCase();
                const checkTarget = this.caseSensitive ? this.target : this.target.toLowerCase();
                
                let match = false;
                switch(this.searchMode) {
                    case 'contains':
                        match = checkAddr.includes(checkTarget);
                        break;
                    case 'startsWith':
                        match = checkAddr.startsWith('0x' + checkTarget);
                        break;
                    case 'endsWith':
                        match = checkAddr.endsWith(checkTarget);
                        break;
                }
                
                if (match) {
                    return addr;
                }
                return null;
            }

            // Recursive layer execution
            runLayer(remaining, tasksCounter) {
                if (tasksCounter.count >= this.maxTasksPerPulse) {
                    return null;
                }

                if (remaining === 1) {
                    // Deepest layer: run branch nanoOps
                    for (let i = 0; i < this.branch; i++) {
                        if (tasksCounter.count >= this.maxTasksPerPulse) break;
                        tasksCounter.count++;
                        const result = this.nanoOp();
                        if (result) return result;
                    }
                    return null;
                } else {
                    // Spawn branch children
                    for (let b = 0; b < this.branch; b++) {
                        if (tasksCounter.count >= this.maxTasksPerPulse) break;
                        const result = this.runLayer(remaining - 1, tasksCounter);
                        if (result) return result;
                    }
                    return null;
                }
            }

            // Global pulse execution
            executePulse() {
                if (this.found.length > 0 && this.autoStop) {
                    this.stop();
                    return;
                }

                const t0 = performance.now();
                const tasksCounter = { count: 0 };

                const result = this.runLayer(this.depth, tasksCounter);
                
                if (result) {
                    this.found.push(result);
                    document.getElementById('elosResults').style.display = 'block';
                    document.getElementById('elosMatch').textContent = 
                        `MATCH FOUND! (#${this.found.length})\n\nAddress: ${result}\n\nTotal Checked: ${this.totalChecked.toLocaleString()}\nPulses: ${this.pulses}\nMatches Found: ${this.found.length}\n\nPattern: "${this.target}" (${this.searchMode})`;
                    toast('üéØ MATCH FOUND! Check results below.', 5000);
                    log('elosLog', `\nüéØ MATCH #${this.found.length} FOUND: ${result}\n`);
                    
                    if (this.autoStop) {
                        this.stop();
                        return;
                    }
                }

                const t1 = performance.now();
                const durMs = t1 - t0;
                this.pulses++;

                // Calculate rate
                const ops = this.totalChecked - this.lastTotal;
                this.lastTotal = this.totalChecked;
                const opsPerSec = Math.round(ops / (durMs / 1000 || 1));
                this.rateWindow.push(opsPerSec);
                if (this.rateWindow.length > 6) this.rateWindow.shift();
                const avgRate = Math.round(this.rateWindow.reduce((a, b) => a + b, 0) / this.rateWindow.length || 0);

                // Update UI
                this.updateStats(tasksCounter.count, durMs, avgRate);

                // Log at configured frequency
                if (this.pulses % this.logFreq === 0) {
                    log('elosLog', `Pulse ${this.pulses} | Checked: ${this.totalChecked.toLocaleString()} | Rate: ${avgRate.toLocaleString()}/s | Tasks: ${tasksCounter.count.toLocaleString()} | Matches: ${this.found.length}`);
                }
            }

            updateStats(tasks, durMs, rate) {
                document.getElementById('statPulses').textContent = this.pulses.toLocaleString();
                document.getElementById('statChecked').textContent = this.totalChecked.toLocaleString();
                document.getElementById('statRate').textContent = rate.toLocaleString();
                document.getElementById('statPulseTime').textContent = durMs.toFixed(1);
                document.getElementById('statTasks').textContent = tasks.toLocaleString();
                
                // Memory estimate (browser doesn't expose exact memory like Node)
                if (performance.memory) {
                    const memMB = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                    document.getElementById('statMemory').textContent = memMB;
                } else {
                    document.getElementById('statMemory').textContent = '‚Äî';
                }
            }

            start() {
                if (this.running) return;
                
                // Load all parameters
                this.depth = parseInt(document.getElementById('elosDepth').value) || 8;
                this.branch = parseInt(document.getElementById('elosBranch').value) || 3;
                this.pulseMs = parseInt(document.getElementById('elosPulseMs').value) || 250;
                this.maxTasksPerPulse = parseInt(document.getElementById('elosMaxTasks').value) || 200000;
                this.target = document.getElementById('elosTarget').value || "000000";
                this.searchMode = document.getElementById('elosSearchMode').value || "contains";
                this.caseSensitive = document.getElementById('elosCaseSensitive').value === "true";
                this.autoStop = document.getElementById('elosAutoStop').value === "true";
                this.logFreq = parseInt(document.getElementById('elosLogFreq').value) || 10;
                this.batchSize = parseInt(document.getElementById('elosBatchSize').value) || 1000;
                this.workers = parseInt(document.getElementById('elosWorkers').value) || 4;

                this.running = true;
                this.totalChecked = 0;
                this.pulses = 0;
                this.found = [];
                this.rateWindow = [];
                this.lastTotal = 0;

                document.getElementById('elosResults').style.display = 'none';
                
                log('elosLog', `\n=== ELOS-DEEP STARTING ===`);
                log('elosLog', `Core: Depth ${this.depth} | Branch ${this.branch} | Pulse ${this.pulseMs}ms | Max Tasks ${this.maxTasksPerPulse.toLocaleString()}`);
                log('elosLog', `Search: Pattern "${this.target}" | Mode: ${this.searchMode} | Case: ${this.caseSensitive ? 'Sensitive' : 'Insensitive'}`);
                log('elosLog', `Performance: Workers ${this.workers} | Batch ${this.batchSize} | Log every ${this.logFreq} pulses`);
                log('elosLog', `Auto-stop: ${this.autoStop ? 'Yes (first match)' : 'No (find multiple)'}`);
                log('elosLog', `Expected tasks per pulse: ~${Math.pow(this.branch, this.depth).toLocaleString()}\n`);

                toast('‚ö° ELOS-DEEP started with custom config!');
                
                this.interval = setInterval(() => this.executePulse(), this.pulseMs);
            }

            stop() {
                if (!this.running) return;
                
                this.running = false;
                if (this.interval) {
                    clearInterval(this.interval);
                    this.interval = null;
                }
                
                log('elosLog', `\n=== ELOS-DEEP STOPPED ===`);
                log('elosLog', `Total Checked: ${this.totalChecked.toLocaleString()}`);
                log('elosLog', `Total Pulses: ${this.pulses}`);
                log('elosLog', `Total Matches: ${this.found.length}`);
                if (this.found.length > 0) {
                    log('elosLog', `Found Addresses: ${this.found.join(', ')}`);
                }
                
                toast('‚è∏Ô∏è ELOS-DEEP stopped');
            }
        }

        // Create global ELOS instance
        const ELOS = new ELOSEngine();

        // Helper function to log to specific element
        function log(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent += message + '\n';
                element.scrollTop = element.scrollHeight;
            }
        }

        // Toast notification system
        function toast(message, duration = 3000) {
            const toastEl = document.createElement('div');
            toastEl.className = 'toast';
            toastEl.textContent = message;
            document.body.appendChild(toastEl);

            setTimeout(() => {
                toastEl.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toastEl.remove(), 300);
            }, duration);
        }

        // Pipeline runner
        async function runPipeline() {
            const code = document.getElementById('pipelineCode').value;
            const output = document.getElementById('pipelineOutput');
            
            try {
                output.textContent = 'Running pipeline...\n\n';
                
                // Create a safe execution context
                const func = new Function('input', code + '\nreturn pipeline(input);');
                const input = { numbers: [1, 2, 3, 4, 5], timestamp: Date.now() };
                
                const result = await func(input);
                
                output.textContent += 'Input:\n' + JSON.stringify(input, null, 2) + '\n\n';
                output.textContent += 'Output:\n' + JSON.stringify(result, null, 2);
                
                toast('‚úÖ Pipeline executed successfully!');
            } catch (error) {
                output.textContent = '‚ùå Error: ' + error.message;
                toast('‚ùå Pipeline error');
            }
        }

        // ============================================================================
        // PARTICLES ANIMATION
        // ============================================================================
        function createParticles() {
            const container = document.getElementById('particles');
            if (!container) return;
            
            for (let i = 0; i < 50; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = Math.random() * 100 + '%';
                p.style.animationDelay = Math.random() * 25 + 's';
                p.style.animationDuration = (20 + Math.random() * 15) + 's';
                container.appendChild(p);
            }
        }

        // ============================================================================
        // EVENT LISTENERS
        // ============================================================================
        document.getElementById('startElos').addEventListener('click', () => ELOS.start());
        document.getElementById('stopElos').addEventListener('click', () => ELOS.stop());
        document.getElementById('runPipeline').addEventListener('click', runPipeline);

        // AI Chat (simple mock for now)
        document.getElementById('sendChat').addEventListener('click', () => {
            const input = document.getElementById('chatInput').value.trim();
            if (!input) return;

            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML += `
                <div style="color: #e2e8f0; background: rgba(0, 217, 163, 0.1); padding: 12px; border-radius: 8px; margin: 10px 0; border-left: 3px solid var(--accent-primary);">
                    <strong>You:</strong> ${input}
                </div>
                <div style="color: var(--text-secondary); background: rgba(0, 0, 0, 0.3); padding: 12px; border-radius: 8px; margin: 10px 0;">
                    <strong>AI:</strong> I'm a mock AI assistant. In a full implementation, I would analyze your ELOS-DEEP performance, suggest optimizations, and help with workflow design. Currently, this is a placeholder for future AI integration.
                </div>
            `;
            chatMessages.scrollTop = chatMessages.scrollHeight;
            document.getElementById('chatInput').value = '';
        });

        // Chat input enter key
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('sendChat').click();
            }
        });

        // ============================================================================
        // FLOATING AI CHAT & MEDIA DOCK
        // ============================================================================
        
        // Toggle AI Chat
        window.toggleAIChat = function() {
            const chatFloat = document.getElementById('aiChatFloat');
            chatFloat.classList.toggle('active');
        };

        // Send AI Message (Floating)
        window.sendAIMessage = function() {
            const input = document.getElementById('aiChatInputFloat').value.trim();
            if (!input) return;

            const chatMessages = document.getElementById('aiChatMessagesFloat');
            
            // Clear welcome message if first interaction
            if (chatMessages.children.length === 1 && chatMessages.children[0].style.textAlign === 'center') {
                chatMessages.innerHTML = '';
            }

            chatMessages.innerHTML += `
                <div style="color: #e2e8f0; background: rgba(0, 217, 163, 0.1); padding: 12px; border-radius: 8px; margin: 10px 0; border-left: 3px solid var(--accent-primary);">
                    <strong>You:</strong> ${input}
                </div>
                <div style="color: var(--text-secondary); background: rgba(0, 0, 0, 0.3); padding: 12px; border-radius: 8px; margin: 10px 0;">
                    <strong>AI:</strong> ${getAIResponse(input)}
                </div>
            `;
            chatMessages.scrollTop = chatMessages.scrollHeight;
            document.getElementById('aiChatInputFloat').value = '';
        };

        // AI Response logic
        function getAIResponse(input) {
            const lower = input.toLowerCase();
            
            if (lower.includes('elos') || lower.includes('optimize')) {
                return 'For optimal ELOS-DEEP performance, try: Depth 8-10, Branch 3-4, Pulse 200-300ms. Monitor your rate/s and adjust based on your hardware. Lower depth with higher branch factor can sometimes yield better results.';
            } else if (lower.includes('parameter') || lower.includes('config')) {
                return 'Key parameters:\n‚Ä¢ Depth: Controls recursion levels (8-12 optimal)\n‚Ä¢ Branch: Number of parallel paths (3-5 recommended)\n‚Ä¢ Pulse: Time between cycles (200-500ms)\n‚Ä¢ Target: Pattern to search for\nAdjust based on your search needs and system capacity.';
            } else if (lower.includes('ipfs') || lower.includes('storage')) {
                return 'Your files are stored in two locations: Public files go to IPFS (decentralized), Private files stay in IndexedDB (local browser storage). IPFS provides permanent, shareable links via CID.';
            } else if (lower.includes('help') || lower.includes('what')) {
                return 'I can help with:\n‚Ä¢ ELOS-DEEP optimization\n‚Ä¢ File storage strategies\n‚Ä¢ Pipeline design\n‚Ä¢ System configuration\n‚Ä¢ Performance tuning\nJust ask me anything!';
            } else {
                return 'I\'m here to help! Ask me about ELOS optimization, file management, or system configuration. I can provide real-time guidance for your workflows.';
            }
        }

        // Enter key for floating chat
        document.getElementById('aiChatInputFloat').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendAIMessage();
            }
        });

        // Toggle Media Dock
        window.toggleMediaDock = function() {
            const dock = document.getElementById('mediaDock');
            dock.classList.toggle('active');
        };

        // Media sources storage
        window.mediaSources = [];

        // Add Media Source
        window.addMediaSource = function() {
            const url = prompt('Enter media URL (YouTube, Facebook, Vimeo, or image/video URL):');
            if (!url) return;

            const mediaSource = {
                id: Date.now(),
                url: url,
                type: detectMediaType(url),
                title: extractMediaTitle(url),
                addedAt: new Date().toISOString()
            };

            window.mediaSources.push(mediaSource);
            localStorage.setItem('elos_media_sources', JSON.stringify(window.mediaSources));
            renderMediaSources();
            toast('‚úÖ Media source added!');
        };

        // Detect media type
        function detectMediaType(url) {
            if (url.includes('youtube.com') || url.includes('youtu.be')) return 'youtube';
            if (url.includes('facebook.com')) return 'facebook';
            if (url.includes('vimeo.com')) return 'vimeo';
            if (url.match(/\.(jpg|jpeg|png|gif|webp)$/i)) return 'image';
            if (url.match(/\.(mp4|webm|ogg)$/i)) return 'video';
            return 'embed';
        }

        // Extract media title
        function extractMediaTitle(url) {
            try {
                const urlObj = new URL(url);
                return urlObj.hostname.replace('www.', '') + ' content';
            } catch {
                return 'Media content';
            }
        }

        // Convert to embed URL
        function getEmbedUrl(url, type) {
            if (type === 'youtube') {
                const videoId = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/)?.[1];
                return videoId ? `https://www.youtube.com/embed/${videoId}` : url;
            }
            if (type === 'vimeo') {
                const videoId = url.match(/vimeo\.com\/(\d+)/)?.[1];
                return videoId ? `https://player.vimeo.com/video/${videoId}` : url;
            }
            if (type === 'facebook') {
                return `https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(url)}`;
            }
            return url;
        }

        // Render media sources
        function renderMediaSources() {
            const container = document.getElementById('mediaContent');
            
            if (window.mediaSources.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-muted);">
                        <div style="font-size: 48px; margin-bottom: 16px;">üì∫</div>
                        <p>No media sources added yet</p>
                        <p style="font-size: 13px; margin-top: 8px;">Click "+ Add Media" to import YouTube, Facebook, or other media</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = window.mediaSources.map(media => {
                const embedUrl = getEmbedUrl(media.url, media.type);
                
                let preview = '';
                if (media.type === 'image') {
                    preview = `<img src="${media.url}" style="width: 100%; height: 100%; object-fit: cover;">`;
                } else if (media.type === 'video') {
                    preview = `<video src="${media.url}" controls style="width: 100%; height: 100%;"></video>`;
                } else {
                    preview = `<iframe src="${embedUrl}" allowfullscreen></iframe>`;
                }

                return `
                    <div class="media-card">
                        <div class="media-preview">
                            ${preview}
                        </div>
                        <div class="media-info">
                            <div class="media-title">${media.title}</div>
                            <div class="media-meta">
                                <span>${media.type.toUpperCase()}</span>
                                <button onclick="removeMedia(${media.id})" style="background: transparent; border: none; color: var(--danger); cursor: pointer; font-size: 12px;">üóëÔ∏è Remove</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Remove media source
        window.removeMedia = function(id) {
            if (!confirm('Remove this media source?')) return;
            
            window.mediaSources = window.mediaSources.filter(m => m.id !== id);
            localStorage.setItem('elos_media_sources', JSON.stringify(window.mediaSources));
            renderMediaSources();
            toast('Media source removed');
        };

        // Load media sources from localStorage
        function loadMediaSources() {
            const saved = localStorage.getItem('elos_media_sources');
            if (saved) {
                try {
                    window.mediaSources = JSON.parse(saved);
                    renderMediaSources();
                } catch (e) {
                    console.error('Failed to load media sources:', e);
                }
            }
        }

        // ============================================================================
        // ENOS SYSTEM - INTEGRATED CAPSULE ENGINE WITH AI INFERENCE
        // ============================================================================

        // 1. GLOBAL NAMESPACE
        window.ENOS = {
            capsules: {},
            loader: {},
            runtime: {},
            ai: {},
            builder: {},
            pulse: {},
            storage: {},
            network: {}
        };

        // ============================================================================
        // 2. INDEXEDDB STORAGE (PERSISTENT CID STORAGE)
        // ============================================================================
        
        // Simple IndexedDB wrapper (no external dependencies)
        ENOS.storage = {
            dbName: 'ENOS',
            dbVersion: 1,
            storeName: 'capsules',

            async openDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.dbVersion);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => resolve(request.result);
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains(this.storeName)) {
                            db.createObjectStore(this.storeName);
                        }
                    };
                });
            },

            async save(cid, files) {
                const db = await this.openDB();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(this.storeName, 'readwrite');
                    const store = tx.objectStore(this.storeName);
                    const request = store.put(files, cid);
                    
                    request.onsuccess = () => {
                        console.log(`[ENOS Storage] Saved CID: ${cid}`);
                        resolve(cid);
                    };
                    request.onerror = () => reject(request.error);
                });
            },

            async fetch(cid) {
                const db = await this.openDB();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(this.storeName, 'readonly');
                    const store = tx.objectStore(this.storeName);
                    const request = store.get(cid);
                    
                    request.onsuccess = () => {
                        const files = request.result;
                        if (!files) {
                            reject(new Error(`CID not found in storage: ${cid}`));
                        } else {
                            console.log(`[ENOS Storage] Fetched CID: ${cid}`);
                            resolve(files);
                        }
                    };
                    request.onerror = () => reject(request.error);
                });
            },

            async list() {
                const db = await this.openDB();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(this.storeName, 'readonly');
                    const store = tx.objectStore(this.storeName);
                    const request = store.getAllKeys();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            async delete(cid) {
                const db = await this.openDB();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(this.storeName, 'readwrite');
                    const store = tx.objectStore(this.storeName);
                    const request = store.delete(cid);
                    
                    request.onsuccess = () => {
                        console.log(`[ENOS Storage] Deleted CID: ${cid}`);
                        resolve();
                    };
                    request.onerror = () => reject(request.error);
                });
            }
        };

        // ============================================================================
        // 3. CID TOOLS (SHA-256 BASED)
        // ============================================================================
        
        ENOS.runtime.cid = {
            async create(files) {
                const text = JSON.stringify(files);
                const data = new TextEncoder().encode(text);
                const hash = await crypto.subtle.digest('SHA-256', data);

                return 'bafk' + [...new Uint8Array(hash)]
                    .map(x => x.toString(16).padStart(2, '0'))
                    .join('');
            }
        };

        // ============================================================================
        // 4. AI INFERENCE MODULE
        // ============================================================================
        
        ENOS.ai = {
            // Run a simple AI model stored in capsule
            runModel(modelFile, input) {
                try {
                    const model = typeof modelFile === 'string' ? JSON.parse(modelFile) : modelFile;
                    
                    // Simple inference based on model type
                    switch(model.type) {
                        case 'inference':
                            // Weighted sum (simple MLP)
                            if (Array.isArray(input) && Array.isArray(model.weights)) {
                                return input.reduce((sum, x, i) => sum + x * (model.weights[i] || 0), 0);
                            }
                            break;
                            
                        case 'classifier':
                            // Simple threshold classifier
                            const value = Array.isArray(input) ? input[0] : input;
                            return value > (model.threshold || 0.5) ? 1 : 0;
                            
                        case 'transformer':
                            // Token processing (mock)
                            if (typeof input === 'string') {
                                return {
                                    tokens: input.split(' '),
                                    embedding: input.length * 0.314,
                                    processed: true
                                };
                            }
                            break;
                    }
                    
                    // Default: pass through with metadata
                    return {
                        input,
                        model: model.model,
                        timestamp: Date.now()
                    };
                } catch (e) {
                    console.error('[ENOS AI] Inference error:', e);
                    return null;
                }
            },

            // AI-powered search parameter interpreter
            applySearchParams(runtime, message) {
                const updates = {};

                // Parse natural language adjustments
                if (/faster|speed up|quick/i.test(message)) updates['pulse'] = Math.min(runtime.pulse * 2, 120);
                if (/slower|slow down/i.test(message)) updates['pulse'] = Math.max(Math.floor(runtime.pulse / 2), 5);
                if (/add fs|filesystem/i.test(message)) {
                    updates['tools'] = [...new Set([...(runtime.tools || []), 'fs'])];
                }
                if (/add ai|enable ai/i.test(message)) {
                    updates['tools'] = [...new Set([...(runtime.tools || []), 'ai'])];
                }
                if (/remove (\w+)/i.test(message)) {
                    const match = message.match(/remove (\w+)/i);
                    const toolToRemove = match[1];
                    updates['tools'] = (runtime.tools || []).filter(t => t !== toolToRemove);
                }

                // Apply allowed updates only
                for (const key in updates) {
                    if (runtime.searchParams?.allowedKeys?.includes(key)) {
                        runtime[key] = updates[key];
                        console.log(`[ENOS AI] Updated ${key} to`, updates[key]);
                    }
                }

                return runtime;
            },

            // Create inference model from data
            createModel(config) {
                return {
                    type: config.type || 'inference',
                    model: config.model || 'tiny-mlp',
                    weights: config.weights || Array(10).fill(0).map(() => Math.random() * 2 - 1),
                    metadata: {
                        version: config.version || '1.0',
                        author: config.author || 'enos',
                        created: Date.now()
                    }
                };
            }
        };

        // ============================================================================
        // 5. BROWSER SANDBOX (ISOLATED EXECUTION)
        // ============================================================================
        
        ENOS.runtime.sandbox = class {
            constructor({ permissions, tools, capabilities }) {
                this.permissions = permissions || {};
                this.tools = tools || [];
                this.capabilities = capabilities || {};
            }

            async loadModule(codeString) {
                try {
                    // Create blob URL for module loading
                    const blob = new Blob([codeString], { type: 'application/javascript' });
                    const url = URL.createObjectURL(blob);

                    const module = await import(url);
                    URL.revokeObjectURL(url);
                    
                    console.log('[ENOS Sandbox] Module loaded successfully');
                    return module;
                } catch (e) {
                    console.error('[ENOS Sandbox] Failed to load module:', e);
                    throw e;
                }
            }

            // Check if action is permitted
            checkPermission(action) {
                const allowed = this.permissions.allowed || [];
                return allowed.includes(action);
            }
        };

        // ============================================================================
        // 6. PULSE ENGINE (WITH AI INTEGRATION)
        // ============================================================================
        
        ENOS.pulse.engine = class {
            constructor(frequency, moduleFn, options = {}) {
                this.frequency = frequency || 25;
                this.moduleFn = moduleFn;
                this.state = options.initialState || {};
                this.timer = null;
                this.pulseCount = 0;
                this.aiModel = options.aiModel || null;
                this.tools = options.tools || { log: console.log };
            }

            start() {
                if (this.timer) return;
                
                const interval = 1000 / this.frequency;
                console.log(`[ENOS Pulse] Starting at ${this.frequency}Hz (${interval}ms interval)`);

                this.timer = setInterval(() => {
                    this.pulseCount++;
                    
                    try {
                        const result = this.moduleFn.tick(
                            this.pulseCount,
                            this.state,
                            this.tools
                        );

                        if (result?.nextState) {
                            this.state = result.nextState;
                        }
                    } catch (e) {
                        console.error('[ENOS Pulse] Tick error:', e);
                    }
                }, interval);
            }

            // Start with AI inference on each pulse
            startAI(inputFn) {
                if (this.timer || !this.aiModel) return;
                
                const interval = 1000 / this.frequency;
                console.log(`[ENOS Pulse AI] Starting at ${this.frequency}Hz with AI inference`);

                this.timer = setInterval(() => {
                    this.pulseCount++;
                    
                    try {
                        // Get input from state
                        const input = inputFn ? inputFn(this.state) : [this.pulseCount];
                        
                        // Run AI inference
                        const aiOutput = ENOS.ai.runModel(this.aiModel, input);
                        
                        // Store AI output in state
                        this.state.aiOutput = aiOutput;
                        this.state.lastPulse = this.pulseCount;
                        
                        this.tools.log(`[AI Pulse ${this.pulseCount}] Input: ${JSON.stringify(input)} ‚Üí Output: ${JSON.stringify(aiOutput)}`);
                        
                        // Run module tick if available
                        if (this.moduleFn?.tick) {
                            const result = this.moduleFn.tick(this.pulseCount, this.state, this.tools);
                            if (result?.nextState) {
                                this.state = { ...this.state, ...result.nextState };
                            }
                        }
                    } catch (e) {
                        console.error('[ENOS Pulse AI] Tick error:', e);
                    }
                }, interval);
            }

            stop() {
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                    console.log(`[ENOS Pulse] Stopped after ${this.pulseCount} pulses`);
                }
            }

            getState() {
                return this.state;
            }
        };

        // ============================================================================
        // 7. CAPSULE BUILDER
        // ============================================================================
        
        ENOS.builder = {
            async buildCapsule(files) {
                const cid = await ENOS.runtime.cid.create(files);
                console.log(`[ENOS Builder] Built capsule with CID: ${cid}`);
                return cid;
            },

            async buildAndSave(files) {
                const cid = await this.buildCapsule(files);
                await ENOS.storage.save(cid, files);
                return cid;
            }
        };

        // ============================================================================
        // 8. CAPSULE LOADER (CID ‚Üí RUNNING SERVICE)
        // ============================================================================
        
        ENOS.loader = {
            async loadFromCID(cid, capsuleFiles = null) {
                // Try to fetch from storage if not provided
                if (!capsuleFiles) {
                    try {
                        capsuleFiles = await ENOS.storage.fetch(cid);
                    } catch (e) {
                        // Try network fetch
                        try {
                            capsuleFiles = await ENOS.network.fetchFromNetwork(cid);
                        } catch (e2) {
                            throw new Error(`Failed to load capsule ${cid}: ${e2.message}`);
                        }
                    }
                }

                const runtime = JSON.parse(capsuleFiles['runtime.json']);
                const permissions = JSON.parse(capsuleFiles['permissions.manifest']);
                const entryCode = capsuleFiles[runtime.entry];

                if (runtime.type !== 'service') {
                    throw new Error('Not a service capsule');
                }

                console.log(`[ENOS Loader] Loading capsule ${cid}`);

                // Create sandbox
                const sandbox = new ENOS.runtime.sandbox({
                    permissions,
                    tools: runtime.tools,
                    capabilities: runtime.capabilities
                });

                // Load module
                const moduleFn = await sandbox.loadModule(entryCode);

                // Check for AI model
                const aiModel = capsuleFiles['ai-model.json'] ? 
                    JSON.parse(capsuleFiles['ai-model.json']) : null;

                // Create pulse engine
                const engine = new ENOS.pulse.engine(runtime.pulse, moduleFn, {
                    aiModel,
                    tools: {
                        log: (msg) => console.log(`[Capsule ${cid.slice(0, 12)}...] ${msg}`)
                    }
                });

                // Start engine
                if (aiModel) {
                    engine.startAI((state) => [state.count || 0]);
                } else {
                    engine.start();
                }

                console.log(`[ENOS Loader] Capsule ${cid} running`);

                return { cid, runtime, engine, sandbox, aiModel };
            }
        };

        // ============================================================================
        // 9. CAPSULE VERSIONING & BRANCHING
        // ============================================================================
        
        ENOS.runtime.updateCapsule = async function(oldCapsule, changes) {
            const updated = { ...oldCapsule, ...changes };
            const newCID = await ENOS.builder.buildCapsule(updated);
            await ENOS.storage.save(newCID, updated);
            
            console.log(`[ENOS Runtime] Updated capsule: ${newCID}`);
            return { newCID, updated };
        };

        ENOS.runtime.branchCapsule = async function(baseCID, changes) {
            const baseFiles = await ENOS.storage.fetch(baseCID);
            const updatedFiles = { ...baseFiles, ...changes };
            const newCID = await ENOS.builder.buildCapsule(updatedFiles);
            await ENOS.storage.save(newCID, updatedFiles);
            
            console.log(`[ENOS Runtime] Branched capsule: ${baseCID.slice(0, 12)}... ‚Üí ${newCID.slice(0, 12)}...`);
            return newCID;
        };

        // ============================================================================
        // 10. NETWORK / IPFS FETCH
        // ============================================================================
        
        ENOS.network = {
            async fetchFromNetwork(cid, urlPrefix = 'https://ipfs.io/ipfs/') {
                console.log(`[ENOS Network] Fetching ${cid} from network...`);
                
                try {
                    const response = await fetch(`${urlPrefix}${cid}`);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    const files = await response.json();
                    
                    // Save to local storage
                    await ENOS.storage.save(cid, files);
                    
                    console.log(`[ENOS Network] Fetched and cached ${cid}`);
                    return files;
                } catch (e) {
                    console.error(`[ENOS Network] Fetch failed:`, e);
                    throw e;
                }
            },

            async fetchFromHTTP(url) {
                console.log(`[ENOS Network] Fetching from ${url}...`);
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    return await response.json();
                } catch (e) {
                    console.error(`[ENOS Network] HTTP fetch failed:`, e);
                    throw e;
                }
            }
        };

        // ============================================================================
        // 11. CAPSULE TEMPLATES
        // ============================================================================
        
        // Basic service capsule
        ENOS.capsules['basic-service'] = {
            'runtime.json': JSON.stringify({
                type: 'service',
                runtime: 'enos-deep',
                entry: 'main.js',
                pulse: 25,
                tools: ['fs', 'ai', 'elos', 'chain', 'capsule'],
                capabilities: {
                    read: ['storage'],
                    write: ['storage']
                },
                searchParams: {
                    autoAdjust: true,
                    allowedKeys: [
                        'pulse',
                        'tools',
                        'capabilities.read',
                        'capabilities.write',
                        'entry',
                        'runtime'
                    ]
                }
            }),

            'main.js': `
export function tick(pulse, state, tools) {
  const count = (state.count || 0) + 1;
  tools.log("Pulse " + pulse + ": count=" + count);
  return { nextState: { count } };
}
`,

            'permissions.manifest': JSON.stringify({
                allowed: [
                    'ai.ask',
                    'fs.read',
                    'fs.write',
                    'elos.spawn',
                    'chain.submit',
                    'capsule.sign'
                ]
            }),

            'schema.json': JSON.stringify({
                serviceVersion: '1.0',
                requiredFiles: ['runtime.json', 'main.js', 'permissions.manifest']
            })
        };

        // AI-powered service capsule
        ENOS.capsules['ai-service'] = {
            'runtime.json': JSON.stringify({
                type: 'service',
                runtime: 'enos-deep',
                entry: 'main.js',
                pulse: 10,
                tools: ['ai', 'storage'],
                capabilities: {
                    read: ['storage'],
                    write: ['storage']
                },
                searchParams: {
                    autoAdjust: true,
                    allowedKeys: ['pulse', 'tools']
                }
            }),

            'main.js': `
export function tick(pulse, state, tools) {
  const count = (state.count || 0) + 1;
  const aiOutput = state.aiOutput;
  
  tools.log("AI Pulse " + pulse + ": count=" + count + ", AI output=" + JSON.stringify(aiOutput));
  
  return { nextState: { count } };
}
`,

            'ai-model.json': JSON.stringify({
                type: 'inference',
                model: 'tiny-mlp',
                weights: [0.12, -0.34, 0.78, 0.45, -0.23, 0.89, -0.67, 0.34, 0.56, -0.12],
                metadata: {
                    version: '1.0',
                    author: 'enos',
                    description: 'Simple weighted sum model'
                }
            }),

            'permissions.manifest': JSON.stringify({
                allowed: ['ai.ask', 'storage.read', 'storage.write']
            }),

            'schema.json': JSON.stringify({
                serviceVersion: '1.0',
                requiredFiles: ['runtime.json', 'main.js', 'ai-model.json', 'permissions.manifest']
            })
        };

        // ============================================================================
        // 12. DEMO & TESTING INTERFACE
        // ============================================================================
        
        window.ENOSDemo = {
            runningServices: [],

            async demo1_BasicCapsule() {
                console.log('\n=== DEMO 1: Basic Service Capsule ===\n');
                
                const capsule = ENOS.capsules['basic-service'];
                const cid = await ENOS.builder.buildAndSave(capsule);
                
                console.log('‚úì Built and saved capsule:', cid);
                
                const service = await ENOS.loader.loadFromCID(cid, capsule);
                this.runningServices.push(service);
                
                console.log('‚úì Service running at CID:', cid);
                
                // Stop after 5 seconds
                setTimeout(() => {
                    service.engine.stop();
                    console.log('‚úì Service stopped');
                    console.log('Final state:', service.engine.getState());
                }, 5000);

                return { cid, service };
            },

            async demo2_AICapsule() {
                console.log('\n=== DEMO 2: AI-Powered Service Capsule ===\n');
                
                const capsule = ENOS.capsules['ai-service'];
                const cid = await ENOS.builder.buildAndSave(capsule);
                
                console.log('‚úì Built and saved AI capsule:', cid);
                
                const service = await ENOS.loader.loadFromCID(cid, capsule);
                this.runningServices.push(service);
                
                console.log('‚úì AI service running at CID:', cid);
                console.log('‚úì AI model:', service.aiModel.model);
                
                // Stop after 5 seconds
                setTimeout(() => {
                    service.engine.stop();
                    console.log('‚úì AI service stopped');
                    console.log('Final state:', service.engine.getState());
                }, 5000);

                return { cid, service };
            },

            async demo3_CapsuleBranching() {
                console.log('\n=== DEMO 3: Capsule Branching ===\n');
                
                const baseCapsule = ENOS.capsules['basic-service'];
                const baseCID = await ENOS.builder.buildAndSave(baseCapsule);
                
                console.log('‚úì Base capsule CID:', baseCID);
                
                // Create a branch with modified pulse rate
                const runtimeMod = JSON.parse(baseCapsule['runtime.json']);
                runtimeMod.pulse = 50; // faster
                
                const branchCID = await ENOS.runtime.branchCapsule(baseCID, {
                    'runtime.json': JSON.stringify(runtimeMod)
                });
                
                console.log('‚úì Branched capsule CID:', branchCID);
                console.log('‚úì Modified pulse from 25Hz to 50Hz');

                return { baseCID, branchCID };
            },

            async demo4_AISearchParams() {
                console.log('\n=== DEMO 4: AI Search Parameter Interpreter ===\n');
                
                const runtime = {
                    pulse: 25,
                    tools: ['fs'],
                    searchParams: {
                        allowedKeys: ['pulse', 'tools']
                    }
                };
                
                console.log('Initial runtime:', runtime);
                
                ENOS.ai.applySearchParams(runtime, 'make it faster and add ai');
                console.log('After "make it faster and add ai":', runtime);
                
                ENOS.ai.applySearchParams(runtime, 'slower please');
                console.log('After "slower please":', runtime);

                return runtime;
            },

            async demo5_ListCapsules() {
                console.log('\n=== DEMO 5: List Stored Capsules ===\n');
                
                const cids = await ENOS.storage.list();
                console.log(`Found ${cids.length} capsules in storage:`);
                cids.forEach((cid, i) => {
                    console.log(`${i + 1}. ${cid}`);
                });

                return cids;
            },

            async demo6_CreateCustomAIModel() {
                console.log('\n=== DEMO 6: Create Custom AI Model ===\n');
                
                const model = ENOS.ai.createModel({
                    type: 'classifier',
                    model: 'threshold-classifier',
                    threshold: 0.7,
                    weights: [1, 2, 3],
                    author: 'demo-user'
                });
                
                console.log('Created AI model:', model);
                
                // Test inference
                const result1 = ENOS.ai.runModel(model, 0.5);
                const result2 = ENOS.ai.runModel(model, 0.9);
                
                console.log('Inference test (0.5):', result1);
                console.log('Inference test (0.9):', result2);

                return model;
            },

            stopAll() {
                console.log('\n=== Stopping All Services ===\n');
                this.runningServices.forEach(service => {
                    service.engine.stop();
                });
                this.runningServices = [];
                console.log('‚úì All services stopped');
            },

            async runAllDemos() {
                console.log('\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');
                console.log('‚ïë  ENOS INTEGRATED DEMO SUITE            ‚ïë');
                console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n');

                await this.demo1_BasicCapsule();
                await new Promise(r => setTimeout(r, 6000));

                await this.demo2_AICapsule();
                await new Promise(r => setTimeout(r, 6000));

                await this.demo3_CapsuleBranching();
                await this.demo4_AISearchParams();
                await this.demo5_ListCapsules();
                await this.demo6_CreateCustomAIModel();

                console.log('\n‚úì All demos completed!');
                console.log('\nAvailable commands:');
                console.log('  ENOSDemo.demo1_BasicCapsule()');
                console.log('  ENOSDemo.demo2_AICapsule()');
                console.log('  ENOSDemo.demo3_CapsuleBranching()');
                console.log('  ENOSDemo.demo4_AISearchParams()');
                console.log('  ENOSDemo.demo5_ListCapsules()');
                console.log('  ENOSDemo.demo6_CreateCustomAIModel()');
                console.log('  ENOSDemo.stopAll()');
            }
        };

        // ============================================================================
        // ENOS INITIALIZATION
        // ============================================================================
        console.log('\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');
        console.log('‚ïë  ENOS SYSTEM INITIALIZED               ‚ïë');
        console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n');
        console.log('‚úì IndexedDB Storage');
        console.log('‚úì CID Builder (SHA-256)');
        console.log('‚úì AI Inference Engine');
        console.log('‚úì Pulse Engine with AI');
        console.log('‚úì Capsule Sandbox');
        console.log('‚úì Capsule Loader');
        console.log('‚úì Branching & Versioning');
        console.log('‚úì Network/IPFS Fetch');
        console.log('\nRun demos: ENOSDemo.runAllDemos()');
        console.log('Or individual: ENOSDemo.demo1_BasicCapsule(), etc.\n');

        // ============================================================================
        // ORIGINAL INITIALIZATION
        // ============================================================================
        window.addEventListener('DOMContentLoaded', () => {
            createParticles();
            toast('‚ö° ELOS Sentinel v3 + ENOS System loaded!', 4000);
            
            setTimeout(() => {
                toast('üå± All systems ready - ENOS integrated!', 3000);
            }, 2000);
        });
    </script>
</body>
</html>
